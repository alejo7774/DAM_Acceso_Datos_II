<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Test Java - Completo y Fácil</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --muted:#9fb0ff; --text:#eef2ff;
      --ok:#2ee59d; --bad:#ff5c7a; --warn:#ffd36a;
      --border: rgba(255,255,255,.10);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1000px 600px at 10% 0%, #1b2a6a 0%, var(--bg) 55%);
      color:var(--text);
      line-height:1.4;
    }
    header{padding:26px 16px 10px; text-align:center;}
    header h1{margin:0 0 6px; font-size:20px; font-weight:850; color: #fff;}
    .container{max-width:800px; margin:0 auto; padding:16px;}
    
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--border);
      border-radius:14px;
      padding:20px;
      margin:16px 0;
      box-shadow: 0 10px 25px rgba(0,0,0,.3);
    }
    
    .badge{
      font-size:11px; padding:4px 8px; border-radius:6px;
      background: rgba(159,176,255,.1);
      color: var(--muted);
      border:1px solid rgba(159,176,255,.2);
      text-transform: uppercase; letter-spacing: 0.5px;
      display: inline-block; margin-bottom: 8px;
    }
    .qtitle{margin:0 0 12px; font-size:17px; font-weight:700; color: #fff;}
    
    /* Estilos Code Block */
    pre{
      margin:10px 0 15px; padding:15px; border-radius:10px; overflow-x:auto;
      background: #080c18; border:1px solid rgba(255,255,255,.1);
      color: #d1d5db;
    }
    code{font-family: 'Consolas', 'Monaco', monospace; font-size:13px;}
    
    /* Código solución (verde/resaltado) */
    .solution-code {
        border-left: 3px solid var(--ok);
        background: rgba(46,229,157,0.05);
    }
    
    /* Estilos Inputs y Textareas */
    input[type="text"], textarea{
      width:100%;
      padding:12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.15);
      background: rgba(0,0,0,.3);
      color:var(--text);
      font-family: inherit;
      font-size:14px;
      margin-bottom: 10px;
      display: block;
    }
    input[type="text"]:focus, textarea:focus{
      border-color: var(--muted);
      outline:none;
      box-shadow: 0 0 0 2px rgba(159,176,255,.2);
    }
    
    /* Estilos Radio Buttons (MCQ) */
    .options{display:flex; flex-direction:column; gap:8px;}
    .opt{
      display:flex; gap:12px; align-items:center;
      padding:12px; border-radius:10px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      cursor: pointer;
      transition: background 0.2s;
    }
    .opt:hover{ background: rgba(255,255,255,.07); }
    
    /* Aumentar visibilidad del radio */
    input[type="radio"] {
        appearance: none;
        width: 18px; height: 18px;
        border: 2px solid var(--muted);
        border-radius: 50%;
        margin: 0;
        display: grid;
        place-content: center;
        flex-shrink: 0;
    }
    input[type="radio"]::before {
        content: "";
        width: 10px; height: 10px;
        border-radius: 50%;
        transform: scale(0);
        transition: 120ms transform ease-in-out;
        box-shadow: inset 1em 1em var(--ok);
    }
    input[type="radio"]:checked::before { transform: scale(1); }
    input[type="radio"]:checked { border-color: var(--ok); }

    /* Botones */
    .btn-row{margin-top:15px; display:flex; gap:10px;}
    button{
      cursor:pointer; border:none; padding:10px 16px; border-radius:8px;
      font-weight:600; font-size:13px; transition: all 0.2s;
    }
    .btn-validate{ background: var(--muted); color: #0b1020; }
    .btn-validate:hover{ background: #b0c0ff; }
    
    /* Status y Memo */
    .status{
      margin-top:15px; padding:12px; border-radius:8px;
      font-size:13px; display: none;
    }
    .status.show{ display: block; animation: fadeIn 0.3s ease; }
    .status.ok{ background: rgba(46,229,157,.15); color: #8affc1; border: 1px solid rgba(46,229,157,.3); }
    .status.bad{ background: rgba(255,92,122,.15); color: #ffadbe; border: 1px solid rgba(255,92,122,.3); }

    .memo-box{
      margin-top:12px; padding:12px; border-left: 3px solid var(--warn);
      background: rgba(255,211,106,.05);
      color: rgba(238,242,255,.9); font-size:13px;
    }
    .memo-box strong { color: var(--warn); display:block; margin-bottom:4px; font-size: 14px; }
    
    .arg-label { font-size: 12px; color: var(--muted); margin-bottom: 5px; display: block; margin-top: 10px;}
    .hidden { display: none; }
    
    /* Score footer */
    .footer {
        position: sticky; bottom: 10px; 
        background: #192138; border: 1px solid var(--border);
        padding: 15px; border-radius: 12px; 
        display: flex; justify-content: space-between; align-items: center;
        box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        z-index: 10;
    }
    @keyframes fadeIn { from{opacity:0; transform:translateY(-5px);} to{opacity:1; transform:translateY(0);} }
  </style>
</head>

<body>
<header>
  <h1>Test: Java IO, JDBC & Hibernate</h1>
  <p style="opacity:0.7; font-size:13px;">Responde mentalmente y verifica tu respuesta.</p>
</header>

<div class="container" id="app"></div>

<div class="container">
  <div class="footer">
    <div style="font-size:13px; color:rgba(255,255,255,0.7)">
      <span id="scoreText">0 / 30 Aciertos</span>
    </div>
    <div style="display:flex; gap:10px;">
        <button onclick="checkAll()" style="background:#2d3752; color:#fff; border:1px solid #444;">Revisar Todo</button>
        <button onclick="resetTest()" style="background:#2d3752; color:#fff; border:1px solid #444;">Reiniciar</button>
    </div>
  </div>
</div>

<script>
  // TEXTOS DE MEMORIZACIÓN FÁCILES Y CORTOS
  const QUESTIONS = [
    // --- MCQ ---
    { id:"q1", type:"mcq", title:"¿Qué interfaz de NIO representa rutas independientes del SO?", options:["File","Path","Files","Reader"], ans:1 },
    { id:"q2", type:"mcq", title:"¿Principal ventaja de Java NIO frente a IO?", options:["Más simple","Solo secuencial","Rendimiento y escalabilidad","Solo XML"], ans:2 },
    { id:"q3", type:"mcq", title:"¿Flujo para leer datos binarios?", options:["Reader","Writer","InputStream","Scanner"], ans:2 },
    { id:"q4", type:"mcq", title:"¿Formato jerárquico por etiquetas?", options:["CSV","JSON","XML","TXT"], ans:2 },
    { id:"q5", type:"mcq", title:"¿Parser XML para ficheros muy grandes?", options:["DOM","SAX","StAX","JDOM"], ans:1 },
    { id:"q6", type:"mcq", title:"¿Convertir XML a objetos Java automáticamente?", options:["Parsing","Marshalling","Binding (JAXB)","Serialización"], ans:2 },
    { id:"q7", type:"mcq", title:"¿Excepción si no existe el fichero?", options:["IOException","FileNotFoundException","SecurityException","Error"], ans:1 },
    { id:"q8", type:"mcq", title:"¿Método para liberar recursos?", options:["flush()","reset()","close()","finalize()"], ans:2 },
    
    // --- CÓDIGO (CÓDIGO ENTERO EN LA PREGUNTA) ---
    { id:"q9", type:"code", 
      title:"Escribir texto plano en archivo.", 
      code:`try (_____ writer = new _____("archivo.txt")) {
    writer.write("Hola mundo");
} catch (IOException e) {
    e.printStackTrace();
}`,
      fullCode:`try (FileWriter writer = new FileWriter("archivo.txt")) {
    writer.write("Hola mundo");
} catch (IOException e) {
    e.printStackTrace();
}`,
      must:["filewriter"], show:"FileWriter",
      memo:"Usamos FileWriter porque es la clase estándar para escribir caracteres (texto) en ficheros." 
    },

    { id:"q10", type:"code", 
      title:"Lectura eficiente línea a línea.", 
      code:`try (BufferedReader reader = new BufferedReader(new FileReader("datos.txt"))) {
    String linea;
    while ((linea = reader.____()) != null) {
        System.out.println(linea);
    }
}`,
      fullCode:`try (BufferedReader reader = new BufferedReader(new FileReader("datos.txt"))) {
    String linea;
    while ((linea = reader.readLine()) != null) {
        System.out.println(linea);
    }
}`,
      must:["readline"], show:"readLine()",
      memo:"Usamos readLine() porque lee una línea entera de texto de golpe, lo cual es muy eficiente." 
    },

    { id:"q11", type:"mcq", title:"¿Interfaz JDBC para la conexión?", options:["Statement","ResultSet","Connection","Driver"], ans:2 },
    { id:"q12", type:"mcq", title:"¿Cargar Driver JDBC tradicionalmente?", options:["DriverManager","Class.forName()","new Driver()","load()"], ans:1 },
    { id:"q13", type:"mcq", title:"¿Ejecutar SQL estático?", options:["Connection","ResultSet","Statement","Prepared"], ans:2 },
    { id:"q14", type:"mcq", title:"¿Ejecutar SQL con parámetros (?)?", options:["Statement","Callable","PreparedStatement","Batch"], ans:2 },
    { id:"q15", type:"mcq", title:"¿Método para SELECT?", options:["execute()","executeUpdate()","executeQuery()","batch()"], ans:2 },
    { id:"q16", type:"mcq", title:"¿Contenedor de resultados SQL?", options:["Statement","Connection","ResultSet","RowSet"], ans:2 },
    { id:"q17", type:"mcq", title:"¿Confirmar transacción?", options:["commit()","rollback()","save()","end()"], ans:0 },
    { id:"q18", type:"mcq", title:"¿Obligatorio al terminar con la BDD?", options:["Log out","close()","null","GC"], ans:1 },

    { id:"q19", type:"code", 
      title:"Transacciones JDBC: Objeto y confirmación.", 
      code:`_____ conn = DriverManager.getConnection(url, user, pass);
conn.setAutoCommit(false);

try {
    PreparedStatement stmt = conn.prepareStatement("INSERT...");
    stmt.executeUpdate();
    conn._____(); // Confirmar cambios
} catch (SQLException e) {
    conn.rollback();
}`,
      fullCode:`Connection conn = DriverManager.getConnection(url, user, pass);
conn.setAutoCommit(false);

try {
    PreparedStatement stmt = conn.prepareStatement("INSERT...");
    stmt.executeUpdate();
    conn.commit(); // Confirmar cambios
} catch (SQLException e) {
    conn.rollback();
}`,
      must:["connection","commit"], show:"Connection y commit()",
      memo:"Connection gestiona la sesión con la base de datos y commit() hace permanentes los cambios." 
    },

    { id:"q20", type:"code", 
      title:"Recoger datos y limpieza.", 
      code:`Statement stmt = conn.createStatement();
// Ejecutar consulta
_____ rs = stmt.executeQuery("SELECT * FROM productos");

try {
    while (rs.next()) {
        System.out.println(rs.getString("nombre"));
    }
} finally {
    rs.close(); // Limpieza obligatoria
}`,
      fullCode:`Statement stmt = conn.createStatement();
// Ejecutar consulta
ResultSet rs = stmt.executeQuery("SELECT * FROM productos");

try {
    while (rs.next()) {
        System.out.println(rs.getString("nombre"));
    }
} finally {
    rs.close(); // Limpieza obligatoria
}`,
      must:["resultset"], show:"ResultSet",
      memo:"ResultSet es la tabla de resultados de la query. Cerramos con close() para liberar memoria." 
    },

    { id:"q21", type:"mcq", title:"¿Qué es ORM?", options:["Object Request","Online Resource","Object-Relational Mapping","Other"], ans:2 },
    { id:"q22", type:"mcq", title:"¿Configuración principal Hibernate?", options:["hibernate.properties","hibernate.cfg.xml","pom.xml","web.xml"], ans:1 },
    { id:"q23", type:"mcq", title:"¿Vincular Clase Java <-> Tabla?", options:["Config","Mapping","Binding","Parsing"], ans:1 },
    { id:"q24", type:"mcq", title:"¿Interfaz principal Hibernate (sesión)?", options:["Session","Transaction","Factory","Manager"], ans:0 },
    { id:"q25", type:"mcq", title:"¿Objeto nuevo no guardado aún?", options:["Persistent","Detached","Transient","Removed"], ans:2 },
    { id:"q26", type:"mcq", title:"¿Guardar objeto nuevo?", options:["persist()","save()","load()","get()"], ans:1 },
    { id:"q27", type:"mcq", title:"¿Lenguaje query Hibernate?", options:["SQL","JPQL","HQL","CQL"], ans:2 },
    { id:"q28", type:"mcq", title:"¿Manejo de transacciones Hibernate?", options:["Session","Connection","Transaction","Query"], ans:2 },

    { id:"q29", type:"code", 
      title:"Anotación para Clase Persistente.", 
      code:`@_____
@Table(name = "usuarios")
public class Usuario {
    @Id
    private Long id;
    // ...
}`,
      fullCode:`@Entity
@Table(name = "usuarios")
public class Usuario {
    @Id
    private Long id;
    // ...
}`,
      must:["@entity"], show:"@Entity",
      memo:"@Entity es obligatorio para decirle a Hibernate que esta clase se debe convertir en una tabla SQL." 
    },

    { id:"q30", type:"code", 
      title:"Guardar y Cerrar Sesión.", 
      code:`Session session = factory.openSession();
Transaction tx = session.beginTransaction();
try {
    Usuario u = new Usuario();
    session._____(u); // Guardar
    tx.commit();
} finally {
    session._____(); // Cerrar
}`,
      fullCode:`Session session = factory.openSession();
Transaction tx = session.beginTransaction();
try {
    Usuario u = new Usuario();
    session.save(u); // Guardar
    tx.commit();
} finally {
    session.close(); // Cerrar
}`,
      must:["save","close"], show:"save() y close()",
      memo:"save() guarda el objeto en la base de datos y close() cierra la conexión para no saturar el servidor." 
    }
  ];

  const state = { answers: {} };

  function render(){
    const app = document.getElementById("app");
    app.innerHTML = QUESTIONS.map((q, i) => {
      const num = i + 1;
      
      // RENDERIZADO PREGUNTAS TIPO TEST (MCQ)
      if(q.type === "mcq"){
        const optsHtml = q.options.map((opt, idx) => `
          <label class="opt">
            <input type="radio" name="g_${q.id}" value="${idx}">
            <span><b>${String.fromCharCode(65+idx)})</b> ${opt}</span>
          </label>
        `).join("");

        return `
          <div class="card" id="card_${q.id}">
            <div class="badge">TEST #${num}</div>
            <div class="qtitle">${q.title}</div>
            <div class="options">${optsHtml}</div>
            <div class="btn-row">
                <button class="btn-validate" onclick="validate('${q.id}')">Comprobar</button>
            </div>
            <div id="status_${q.id}" class="status"></div>
          </div>
        `;
      }

      // RENDERIZADO PREGUNTAS TIPO CÓDIGO + ARGUMENTACIÓN
      return `
        <div class="card" id="card_${q.id}">
          <div class="badge">CÓDIGO #${num}</div>
          <div class="qtitle">${q.title}</div>
          
          <div style="font-size:13px; color:#aaa; margin-bottom:5px;">Código incompleto:</div>
          <pre><code>${q.code}</code></pre>
          
          <label class="arg-label">Completa el código (los huecos):</label>
          <input type="text" id="in_${q.id}" placeholder="Escribe tu respuesta aquí...">
          
          <div class="btn-row">
            <button class="btn-validate" onclick="validate('${q.id}')">Validar y Ver Justificación</button>
          </div>
          
          <div id="status_${q.id}" class="status"></div>
          
          <div id="memo_${q.id}" class="status memo-box hidden">
             <strong>Argumentación (Memoriza):</strong>
             <p style="margin:5px 0 10px;">${q.memo}</p>
             <div style="font-weight:bold; color:#fff; font-size:12px;">CÓDIGO COMPLETO (SOLUCIÓN):</div>
             <pre class="solution-code"><code>${q.fullCode}</code></pre>
          </div>
        </div>
      `;
    }).join("");
  }

  function validate(id){
    const q = QUESTIONS.find(x => x.id === id);
    const statusEl = document.getElementById(`status_${id}`);
    
    let isCorrect = false;

    if(q.type === "mcq"){
      const checked = document.querySelector(`input[name="g_${id}"]:checked`);
      if(!checked){
        statusEl.className = "status show";
        statusEl.innerHTML = "⚠️ Selecciona una opción.";
        return;
      }
      const val = parseInt(checked.value);
      isCorrect = (val === q.ans);
      
      statusEl.className = `status show ${isCorrect ? 'ok' : 'bad'}`;
      statusEl.innerHTML = isCorrect 
        ? "✅ ¡Correcto!" 
        : `❌ Incorrecto. La correcta es: <b>${q.options[q.ans]}</b>`;

    } else {
      // Validación código
      const inputVal = (document.getElementById(`in_${id}`).value || "").toLowerCase().trim();
      const codeOk = q.must.every(k => inputVal.includes(k));
      isCorrect = codeOk;

      statusEl.className = `status show ${isCorrect ? 'ok' : 'bad'}`;
      
      let msg = "";
      if(codeOk) msg += "✅ Muy bien. Respuesta correcta.<br>";
      else msg += `❌ Incorrecto. (Faltaba: <b>${q.show}</b>)<br>`;
      
      statusEl.innerHTML = msg;
      
      // MOSTRAR LA ARGUMENTACIÓN JUSTIFICATIVA SIEMPRE AL FINAL
      document.getElementById(`memo_${id}`).classList.remove("hidden");
    }

    state.answers[id] = isCorrect;
    updateScore();
  }

  function updateScore(){
    const correctas = Object.values(state.answers).filter(Boolean).length;
    document.getElementById("scoreText").textContent = `${correctas} / ${QUESTIONS.length} Aciertos`;
  }

  function checkAll(){
    QUESTIONS.forEach(q => validate(q.id));
  }

  function resetTest(){
    if(confirm("¿Reiniciar todo?")){
       state.answers = {};
       render();
       updateScore();
       window.scrollTo(0,0);
    }
  }

  // Init
  render();
</script>
</body>
</html>
